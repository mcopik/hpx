# one needs to update this variables before compiling!
BOOST_ROOT=/home/mcopik/Projekty/steiar/boost_1_58_0/
AMP_SOURCE=/home/mcopik/Projekty/steiar/cppamp-driver-ng/
AMP_BUILD=/home/mcopik/Projekty/steiar/cppamp_driver_build/
HPX_SOURCE=/home/mcopik/Projekty/steiar/hpx/
HPX_BUILD=/home/mcopik/Projekty/steiar/hpx_build_libcc

# HPX flags taken directly from commands generated by CMake
CXX=$(AMP_BUILD)/compiler/bin/clang++
HPX_CXXFLAGS=-DHPX_APPLICATION_EXPORTS -DHPX_APPLICATION_NAME=foreach_test_exe -DHPX_APPLICATION_STRING="\"foreach_test_exe\"" -DHPX_PREFIX="\"/home/mcopik/Projekty/hpx/hpx_build_clang\"" -D_GNU_SOURCE -fno-builtin-cfree -fno-builtin-pvalloc -fno-builtin-malloc -fno-builtin-free -fno-builtin-calloc -fno-builtin-realloc -fno-builtin-valloc -fno-builtin-memalign -fno-builtin-posix_memalign -std=c++11 -Wall -Wextra -Wno-strict-aliasing -Wno-sign-promo -Wno-attributes -Wno-cast-align -Wno-unused-parameter -Wno-ignored-qualifiers -Wformat=2 -Wno-format-nonliteral -Winit-self -Wcast-qual -Werror=parentheses -Werror=reorder -Werror=return-type -Werror=sequence-point -Werror=format -Werror=missing-braces -Werror=sign-compare -fdiagnostics-show-option -Werror=vla -Werror=return-type -Wno-cast-align -O3 -DNDEBUG -DHPX_DISABLE_ASSERTS -DBOOST_DISABLE_ASSERTS
HPX_SRCS= factorial.cpp
HPX_INCLUDES= -I$(HPX_SOURCE) -I$(HPX_BUILD) -I$(HPX_SOURCE)/external/serialization -I$(HPX_SOURCE)/external/cache -I$(HPX_SOURCE)/external/endian -I$(HPX_SOURCE)/examples -I$(HPX_SOURCE)/tests
HPX_LIBCXX= -stdlib=libc++ -I $(AMP_SOURCE)/libc++/libcxx/include/ -I $(AMP_SOURCE)/libc++/libcxxrt/src/
HPX_OBJS = $(HPX_SRCS:%.cpp=%.o)

TARGET_DIR=../bin
TARGET=$(TARGET_DIR)/factorial_amp

$(TARGET): dirs $(HPX_OBJS) $(AMP_OBJS)
	$(CXX) $(CXXFLAGS) -o $(TARGET) $(HPX_OBJS)

all:    $(TARGET)

$(HPX_OBJS): %.o : %.cpp
	$(CXX) $(HPX_CXXFLAGS) $(HPX_INCLUDES) $(HPX_LIBCXX) -c $<  -o $@
.cpp.o:
	$(CXX) $(CXXFLAGS) -c $<  -o $@

dirs:	$(TARGET_DIR)

$(TARGET_DIR):
	mkdir -p $(TARGET_DIR)

clean:
	rm -f $(HPX_OBJS) $(TARGET) $(AMP_OBJS)

